<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HYBREED INVENTORY DASHBOARD</title>
  <style>
    /* (Same styling as before, walang binago) */
  </style>
</head>

<body>
  <div class="main">
    <div class="header-row">
      <div class="header">HYBREED INVENTORY DASHBOARD</div>
      <div class="search-box">
        <input type="text" placeholder="Search" id="searchInput" onkeyup="searchTable()">
        <button onclick="searchTable()">Search</button>
      </div>
    </div>

    <div class="dashboard">
      <div class="quick-links">
        <a href="#" onclick="window.location.reload()">üè† Home</a>
        <a href="https://script.google.com/macros/s/AKfycbxTvIJBzAHvkWdMKvjvj0yJasOk7JJxuqNK_RVQ6rg3J5TsZx_BH_PX_jodhXoEwNrq2Q/exec" target="_blank">üìù Inventory Updater</a>
        <a href="https://script.google.com/macros/s/AKfycbytxwCDNnMUzzoHEJFcG2R2xLn5TsfgzRxwj7weTgM/exec" target="_blank">üì¶ Stock Receiving Forms</a>
        <a href="https://script.google.com/macros/s/AKfycbwzfev8WG1J_fGDCLKMzKAZzL8C7en1uchR8aW2pwC-Uh1IYjPVWISLeSLlXw7S3kZF/exec" target="_blank">üìä Inventory Supplies Record</a>
      </div>

      <div class="main-content">
        <div class="card-row">
          <div class="card green">üì¶<br>Stock In Today<br><div id="stockInToday" style="font-size: 26px;">0</div></div>
          <div class="card yellow">‚úèÔ∏è<br>Low Stock Items<br><div id="lowStock" style="font-size: 26px;">0</div></div>
          <div class="card red">‚ùå<br>Out of Stock Items<br><div id="outOfStock" style="font-size: 26px;">0</div></div>
        </div>

        <button class="filter-button" onclick="fetchAndDisplayData()">Refresh</button>

        <table id="stockTable">
          <thead>
            <tr>
              <th>Item Name</th>
              <th>Category</th>
              <th>Status</th>
              <th>Stock</th>
              <th>Last Updated</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbwv_fCxZsShYT60ylwV57PSidy5s2w6pVsd-CiBkGy_ZmUjhcdL2sVfFcLgunxjVvox/exec";

function fetchAndDisplayData() {
  fetch(SHEET_API_URL)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#stockTable tbody");
      tbody.innerHTML = "";

      let stockInToday = 0;
      let lowStock = 0;
      let outOfStock = 0;

      const today = new Date().toISOString().split('T')[0]; // today's date in yyyy-mm-dd format

      data.forEach(row => {
        const itemName = row["Item Name"] || "-";
        const category = row["Category"] || "-";
        const currentStock = parseInt(row["Current Stock"]) || 0;
        const criticalLevel = parseInt(row["Critical Level"]) || 0;
        const updated = row["Last Updated"] || "-";

        // Determine Status based on Critical Level
        let statusText = "";
        let statusClass = "";

        if (currentStock === 0) {
          statusText = "Out of Stock";
          statusClass = "out-of-stock";
          outOfStock++;
        } else if (currentStock <= criticalLevel) {
          statusText = "Needs Reorder";
          statusClass = "needs-reorder";
          lowStock++;
        } else {
          statusText = "In Stock";
          statusClass = "in-stock";
        }

        // Count Stock In Today (if Last Updated == today)
        if (updated.split('T')[0] === today) {
          stockInToday++;
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${itemName}</td>
          <td>${category}</td>
          <td><span class="badge ${statusClass}">${statusText}</span></td>
          <td>${currentStock}</td>
          <td>${updated}</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("stockInToday").innerText = stockInToday;
      document.getElementById("lowStock").innerText = lowStock;
      document.getElementById("outOfStock").innerText = outOfStock;
    })
    .catch(err => console.error("Failed to load data:", err));
}

function searchTable() {
  const input = document.getElementById("searchInput").value.toUpperCase();
  const table = document.getElementById("stockTable");
  const trs = table.querySelectorAll("tbody tr");

  trs.forEach(tr => {
    const td = tr.querySelector("td");
    if (td && td.textContent.toUpperCase().indexOf(input) > -1) {
      tr.style.display = "";
    } else {
      tr.style.display = "none";
    }
  });
}

window.onload = fetchAndDisplayData;
</script>

</body>
</html>
